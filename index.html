<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-fullscreen">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Mobile Mapper - Projection Mapping</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Main Canvas -->
        <canvas id="mainCanvas"></canvas>
        <canvas id="overlayCanvas"></canvas>
        
        <!-- Toggle Sidebar Button (Fixed Position) -->
        <button id="toggleSidebarBtn" class="toggle-sidebar-btn">
            <span class="icon">‚ò∞</span>
        </button>

        <!-- Left Sidebar (Tools & Layers) -->
        <div id="leftSidebar" class="sidebar left-sidebar">
            <!-- Tools Section -->
            <div class="sidebar-section">
                <h3>Tools</h3>
                <div class="tool-grid">
                    <button id="addTriangleBtn" class="tool-btn" title="Add Triangle">‚ñ≥</button>
                    <button id="addSquareBtn" class="tool-btn" title="Add Square">‚ñ°</button>
                    <button id="addCircleBtn" class="tool-btn" title="Add Circle">‚óã</button>
                    <button id="drawPolygonBtn" class="tool-btn" title="Draw Polygon">‚¨†</button>
                    <button id="addCanvasBtn" class="tool-btn" title="Add Drawing Canvas">üñåÔ∏è</button>
                    <button id="selectBtn" class="tool-btn active" title="Select/Move">‚äï</button>
                    <button id="brushBtn" class="tool-btn" title="Brush Tool">‚úèÔ∏è</button>
                    <button id="deleteBtn" class="tool-btn danger" title="Delete Selected">üóë</button>
                </div>
            </div>

            <!-- Brush Controls (Contextual) -->
            <div id="brushControls" class="sidebar-section hidden">
                <h3>Brush Settings</h3>
                <div class="control-group">
                    <label>Size: <span id="brushSizeVal">5</span></label>
                    <input type="range" id="brushSizeSlider" min="1" max="50" value="5">
                </div>
                <div class="control-group">
                    <label>Opacity: <span id="brushOpacityVal">1.0</span></label>
                    <input type="range" id="brushOpacitySlider" min="0.1" max="1.0" step="0.1" value="1.0">
                </div>
                <div class="control-group">
                    <label>Color</label>
                    <input type="color" id="brushColorPicker" value="#ffffff" style="width:100%;">
                </div>
                <div class="control-group row">
                    <label>Eraser</label>
                    <input type="checkbox" id="eraserToggle">
                </div>
                <button id="clearCanvasBtn" class="action-btn full-width" style="margin-top:8px;">Clear Canvas</button>
            </div>

            <!-- Layers List -->
            <div class="sidebar-section">
                <h3>Layers</h3>
                <div id="layersListContainer" class="layers-list">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>

        <!-- Right Sidebar (Properties & Effects) -->
        <div id="rightSidebar" class="sidebar right-sidebar hidden">
            <!-- Content & Mode -->
            <div class="sidebar-section">
                <h3>Properties</h3>
                <div class="info-display" id="currentContentInfo">Shader: Rainbow</div>
                <div style="margin-top: 8px; display: flex; gap: 8px;">
                    <button id="changeContentBtn" class="action-btn flex-1">Change Content</button>
                </div>
                <div class="control-group row" style="margin-top: 12px;">
                    <label>Warp Mode</label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="warpToggle">
                        <span class="slider"></span>
                    </div>
                </div>
                <div class="control-group row" style="margin-top: 8px;">
                    <label>Show Curve Controls</label>
                    <button id="toggleCurveBtn" class="action-btn small">Toggle</button>
                </div>
                
                <!-- Canvas Mask Option -->
                <div id="canvasMaskControl" class="control-group row hidden" style="margin-top: 8px;">
                    <label>Use as Mask</label>
                    <input type="checkbox" id="useAsMaskToggle">
                </div>
            </div>

            <!-- Audio Reactivity -->
            <div class="sidebar-section">
                <h3>Audio Reactivity</h3>
                <div class="control-group row">
                    <label>Enabled</label>
                    <input type="checkbox" id="audioEnabledToggle">
                </div>
                <div class="control-group">
                    <label>Gain</label>
                    <input type="range" id="audioGainSlider" min="0" max="5" step="0.1" value="1">
                </div>
                <div class="control-group">
                    <label>Bass Reactivity</label>
                    <input type="range" id="audioBassSlider" min="0" max="5" step="0.1" value="1">
                </div>
                <div class="control-group">
                    <label>Mid Reactivity</label>
                    <input type="range" id="audioMidSlider" min="0" max="5" step="0.1" value="1">
                </div>
                <div class="control-group">
                    <label>High Reactivity</label>
                    <input type="range" id="audioHighSlider" min="0" max="5" step="0.1" value="1">
                </div>
            </div>

            <!-- Effects -->
            <div class="sidebar-section">
                <h3>Effects</h3>
                <div class="dropdown-container">
                    <select id="effectTypeSelect" class="dropdown">
                        <option value="brightness">Brightness</option>
                        <option value="contrast">Contrast</option>
                        <option value="saturation">Saturation</option>
                        <option value="hue">Hue Shift</option>
                        <option value="scanlines">Scanlines</option>
                        <option value="dots">Dots Pattern</option>
                        <option value="grid">Grid Pattern</option>
                        <option value="border">Animated Border</option>
                    </select>
                    <button id="addEffectBtn" class="action-btn full-width">+ Add Effect</button>
                </div>
                <div id="effectsListContainer" class="effects-list">
                    <!-- Effects populated here -->
                </div>
            </div>
        </div>

        <!-- Top Bar (Global Controls) -->
        <div id="uiContainer" class="top-bar">
            <div class="logo">Mobile Mapper</div>
            <div class="global-controls">
                <button id="audioToggleBtn" class="mode-btn" title="Toggle Audio Input">üé§</button>
                <button id="performanceBtn" class="mode-btn">Perform</button>
                <button id="fullscreenBtn" class="mode-btn">‚õ∂</button>
                <button id="saveBtn" class="mode-btn">Save</button>
                <button id="loadBtn" class="mode-btn">Load</button>
            </div>
        </div>

        <!-- Fine-tune vertex controls -->
        <div id="vertexControls" class="vertex-controls hidden">
            <div class="control-drag-handle"></div>
            <div class="control-pad">
                <div class="spacer"></div>
                <button class="arrow-btn" data-dir="up">‚Üë</button>
                <div class="spacer"></div>
                <button class="arrow-btn" data-dir="left">‚Üê</button>
                <button class="arrow-btn" data-dir="down">‚Üì</button>
                <button class="arrow-btn" data-dir="right">‚Üí</button>
            </div>
            <div class="fine-tune-label">Fine Tune</div>
        </div>

        <!-- Modals -->
        <div id="contentModal" class="modal hidden">
            <div class="modal-content">
                <h2>Select Content Type</h2>
                <button class="content-type-btn" data-type="shader">Shader</button>
                <button class="content-type-btn" data-type="video">Video</button>
                <button class="close-modal">Cancel</button>
            </div>
        </div>

        <div id="shaderModal" class="modal hidden">
            <div class="modal-content">
                <h2>Select Shader</h2>
                <div id="shaderList" class="shader-list">
                    <button class="shader-btn" data-shader="rainbow">Rainbow</button>
                    <button class="shader-btn" data-shader="plasma">Plasma</button>
                    <button class="shader-btn" data-shader="waves">Waves</button>
                    <button class="shader-btn" data-shader="checkerboard">Checkerboard</button>
                    <button class="shader-btn" data-shader="solid">Solid Color</button>
                    <button class="shader-btn" data-shader="kaleidoscope">Kaleidoscope</button>
                    <button class="shader-btn" data-shader="fractal">Fractal</button>
                </div>
                <button class="close-modal">Back</button>
            </div>
        </div>

        <div id="videoModal" class="modal hidden">
            <div class="modal-content">
                <h2>Select Video</h2>
                <input type="file" id="videoFileInput" accept="video/*" />
                <div id="videoList" class="video-list"></div>
                <button class="close-modal">Back</button>
            </div>
        </div>

        <div id="welcomeModal" class="modal">
            <div class="modal-content welcome-modal-content">
                <h2>Mobile Mapper</h2>
                <p class="welcome-subtitle">Projection Mapping Tool</p>
                <div class="welcome-buttons">
                    <button id="newProjectBtn" class="welcome-btn">New Project</button>
                    <button id="loadProjectFileBtn" class="welcome-btn">Load File</button>
                    <button id="continueProjectBtn" class="welcome-btn" disabled>Continue</button>
                </div>
            </div>
        </div>

        <div id="performanceOverlay" class="hidden"></div>
        <div id="statusMsg" class="status-msg hidden"></div>
    </div>
    <script type="module" src="/src/app.ts"></script>
</body>
</html>
