<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Mobile Mapper V2</title>
    <!-- <link rel="stylesheet" href="styles.css" /> -->
    <link rel="manifest" href="manifest.json" />
    <script type="module" crossorigin src="./assets/index-BJ-5O6vz.js"></script>
    <link rel="stylesheet" crossorigin href="./assets/index-DPgOYVra.css">
  </head>
  <body>
    <div id="canvasContainer">
      <canvas id="mainCanvas"></canvas>
      <canvas id="overlayCanvas"></canvas>
    </div>

    <!-- Independent Toggle Button -->
    <button id="toggleSidebarBtn" class="tool-btn" title="Toggle Menu">
      ‚ò∞
    </button>

    <!-- UI Container -->
    <div id="uiContainer" class="ui-container">
      <!-- Top Bar -->
      <div class="top-bar">
        <div class="app-logo"><span>‚¨°</span> MobileMapper</div>
        <div class="top-controls">
          <!-- Audio Toggle -->
          <button
            id="audioToggleBtn"
            class="mode-btn"
            title="Toggle Audio Reactivity"
          >
            üé§
          </button>
          <button
            id="performanceBtn"
            class="mode-btn"
            title="Performance Mode (Hide UI)"
          >
            üé≠
          </button>
          <button id="fullscreenBtn" class="mode-btn" title="Fullscreen">
            ‚õ∂
          </button>
          <button id="saveBtn" class="action-btn" title="Save Project">
            üíæ
          </button>
          <button id="loadBtn" class="action-btn" title="Load Project">
            üìÇ
          </button>
        </div>
      </div>

      <!-- Left Sidebar (Shapes & Tools & Layers) -->
      <div id="leftSidebar" class="sidebar left-sidebar">
        <div class="sidebar-section">
          <h3>Add Shape</h3>
          <div class="tool-grid">
            <button id="addTriangleBtn" class="tool-btn" title="Triangle">
              ‚ñ≤
            </button>
            <button id="addSquareBtn" class="tool-btn" title="Square">‚ñ†</button>
            <button id="addCircleBtn" class="tool-btn" title="Circle">‚óè</button>
            <button id="drawPolygonBtn" class="tool-btn" title="Draw Polygon">
              ‚úèÔ∏è
            </button>
          </div>
        </div>

        <div class="sidebar-section">
          <h3>Tools</h3>
          <div class="tool-grid">
            <button id="selectBtn" class="tool-btn active" title="Select">
              üëÜ
            </button>
            <button id="deleteBtn" class="tool-btn" title="Delete Selected">
              üóëÔ∏è
            </button>
          </div>
        </div>

        <!-- Layers Panel -->
        <div class="sidebar-section">
          <h3>Layers</h3>
          <div id="layersListContainer" class="layers-list">
            <!-- Dynamic Layers -->
          </div>
        </div>
      </div>

      <!-- Right Sidebar (Properties & Effects) -->
      <div id="rightSidebar" class="sidebar right-sidebar hidden">
        <div class="sidebar-section">
          <h3>Content</h3>
          <button id="changeContentBtn" class="action-btn" style="width: 100%">
            Change Content
          </button>
          <div
            id="currentContentInfo"
            class="info-display"
            style="font-size: 12px; margin-top: 8px; opacity: 0.7"
          >
            Shader: Rainbow
          </div>
        </div>

        <div class="sidebar-section">
          <h3>Warping</h3>
          <div class="toggle-row">
            <span style="font-size: 12px">Mesh Warp</span>
            <label class="toggle-switch">
              <input type="checkbox" id="warpToggle" />
              <span class="slider"></span>
            </label>
          </div>
        </div>

        <!-- Audio Reactivity Settings -->
        <div class="sidebar-section">
          <h3>Audio Reactivity</h3>
          <div class="toggle-row">
            <span style="font-size: 12px">Enable Audio</span>
            <label class="toggle-switch">
              <input type="checkbox" id="audioEnabledToggle" />
              <span class="slider"></span>
            </label>
          </div>
          <div class="control-group">
            <label>Gain (Strength)</label>
            <input
              type="range"
              id="audioGainSlider"
              min="0"
              max="5"
              step="0.1"
              value="1"
            />
          </div>
          <div class="control-group">
            <label>Bass Influence</label>
            <input
              type="range"
              id="audioBassSlider"
              min="0"
              max="2"
              step="0.1"
              value="1"
            />
          </div>
          <div class="control-group">
            <label>Mid Influence</label>
            <input
              type="range"
              id="audioMidSlider"
              min="0"
              max="2"
              step="0.1"
              value="1"
            />
          </div>
          <div class="control-group">
            <label>High Influence</label>
            <input
              type="range"
              id="audioHighSlider"
              min="0"
              max="2"
              step="0.1"
              value="1"
            />
          </div>
        </div>

        <div class="sidebar-section">
          <h3>Effects Stack</h3>
          <div class="control-group">
            <select id="effectTypeSelect" class="dropdown">
              <option value="brightness">Brightness</option>
              <option value="contrast">Contrast</option>
              <option value="saturation">Saturation</option>
              <option value="hue">Hue Shift</option>
              <option value="border">Border</option>
              <option value="scanlines">Scanlines</option>
              <option value="dots">Dots Pattern</option>
              <option value="grid">Grid Pattern</option>
            </select>
            <button id="addEffectBtn" class="add-btn">+ Add Effect</button>
          </div>
          <div id="effectsListContainer" class="effects-list">
            <!-- Dynamic Effects Go Here -->
          </div>
        </div>
      </div>

      <!-- Vertex Fine Tune Controls (Floating) -->
      <div id="vertexControls" class="vertex-controls hidden">
        <div class="control-drag-handle"></div>
        <div class="control-pad">
          <div></div>
          <button class="arrow-btn" data-dir="up">‚ñ≤</button>
          <div></div>
          <button class="arrow-btn" data-dir="left">‚óÄ</button>
          <div
            style="
              width: 30px;
              height: 30px;
              background: rgba(255, 255, 255, 0.1);
              border-radius: 50%;
            "
          ></div>
          <button class="arrow-btn" data-dir="right">‚ñ∂</button>
          <div></div>
          <button class="arrow-btn" data-dir="down">‚ñº</button>
          <div></div>
        </div>
        <div class="fine-tune-label">Fine Tune</div>
        <button
          id="toggleCurveBtn"
          class="mode-btn"
          style="margin-top: 8px; font-size: 10px; padding: 6px 12px"
        >
          Toggle Curve
        </button>
      </div>
    </div>

    <!-- Performance Mode Overlay (Click to exit) -->
    <div id="performanceOverlay" class="hidden"></div>

    <!-- Modals -->
    <div id="contentModal" class="modal hidden">
      <div class="modal-content">
        <h2>Select Content Type</h2>
        <button
          class="content-type-btn"
          data-type="shader"
          style="margin-bottom: 8px; width: 100%"
        >
          Shader
        </button>
        <button class="content-type-btn" data-type="video" style="width: 100%">
          Video
        </button>
        <button class="close-modal" style="margin-top: 16px">Cancel</button>
      </div>
    </div>

    <div id="shaderModal" class="modal hidden">
      <div class="modal-content">
        <h2>Select Shader</h2>
        <div
          id="shaderList"
          class="shader-list"
          style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px"
        >
          <button class="shader-btn" data-shader="rainbow">Rainbow</button>
          <button class="shader-btn" data-shader="plasma">Plasma</button>
          <button class="shader-btn" data-shader="waves">Waves</button>
          <button class="shader-btn" data-shader="checkerboard">
            Checkerboard
          </button>
          <button class="shader-btn" data-shader="grid">Grid</button>
          <button class="shader-btn" data-shader="solid">Solid Color</button>
          <!-- New Psychedelic Shaders -->
          <button class="shader-btn" data-shader="kaleidoscope">
            Kaleidoscope
          </button>
          <button class="shader-btn" data-shader="fractal">Fractal</button>
        </div>
        <button class="close-modal" style="margin-top: 16px">Back</button>
      </div>
    </div>

    <div id="videoModal" class="modal hidden">
      <div class="modal-content">
        <h2>Select Video</h2>
        <input
          type="file"
          id="videoFileInput"
          accept="video/*"
          style="margin-bottom: 16px; color: white"
        />
        <div id="videoList" class="video-list">
          <!-- Loaded videos will appear here -->
        </div>
        <button class="close-modal" style="margin-top: 16px">Back</button>
      </div>
    </div>

    <!-- Welcome Modal -->
    <div id="welcomeModal" class="modal hidden">
      <div class="modal-content welcome-modal-content">
        <h2>Mobile Mapper</h2>
        <p class="welcome-subtitle" style="opacity: 0.7; margin-bottom: 24px">
          Minimal Projection Tool
        </p>
        <div
          class="welcome-buttons"
          style="display: flex; flex-direction: column; gap: 12px"
        >
          <button id="newProjectBtn" class="welcome-btn">
            <span class="btn-text">New Project</span>
          </button>
          <button id="loadProjectFileBtn" class="welcome-btn">
            <span class="btn-text">Load from File</span>
          </button>
          <button id="continueProjectBtn" class="welcome-btn" disabled>
            <span class="btn-text">Continue Last Session</span>
          </button>
        </div>
      </div>
    </div>

    <div id="statusMsg" class="status-msg hidden">Status Message</div>

    <!-- Scripts (Updated for Vite/TS) -->
  </body>
</html>
